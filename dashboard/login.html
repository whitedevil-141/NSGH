<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NSGH Admin Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="css/style.css">
</head>
<body class="login-body">

<div class="login-box">
  <h2>NSGH Admin Login</h2>
  <form id="loginForm">
    <div class="form-group mb-3">
      <input type="text" class="form-control" name="username" placeholder="Username" required>
    </div>
    <div class="form-group mb-3">
      <input type="password" class="form-control" name="password" placeholder="Password" required>
    </div>
    <button class="btn btn-primary w-100" type="submit">Login</button>
  </form>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const form = e.target;
  const username = form.username.value;
  const password = form.password.value;

  try{
    const res = await fetch('http://localhost:5000/auth/login', {
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body: new URLSearchParams({username,password})
    });
    
    if(!res.ok){ 
      alert('Login failed'); 
      return; 
    }
    
    // After successful login
    const tokenData = await res.json();
    const expiresAt = Math.floor(Date.now() / 1000) + tokenData.expires_in;

    sessionStorage.setItem('token', tokenData.access_token);
    sessionStorage.setItem('token_expiry', expiresAt);
    window.location.href='dashboard.html';
    

    
  } catch(err){
    console.error(err);
    alert('Error connecting to server');
  }
});
</script>

</body>
</html>
